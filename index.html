<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Helmy Card - Ø³Ø­Ø¨ Ø§Ù„Ø±Ø§ØªØ¨</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;900&display=swap');
        
        :root {
            --gold: linear-gradient(135deg, #bf953f 0%, #fcf6ba 45%, #b38728 70%, #fbf5b7 100%);
            --bg: #050505;
            --card-bg: #0d0d0d;
            --text-gold: #fcf6ba;
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--bg);
            background-image: radial-gradient(circle at top left, #1a1a1a, #050505);
            color: #f8fafc; margin: 0; display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 20px;
        }

        .form-card {
            background: var(--card-bg);
            border: 1px solid rgba(191, 149, 63, 0.3);
            border-radius: 30px;
            padding: 30px; width: 100%; max-width: 480px; 
            box-shadow: 0 25px 50px rgba(0,0,0,0.9);
            position: relative;
        }

        .header { text-align: center; margin-bottom: 25px; }
        .header h1 { 
            font-size: 32px; font-weight: 900; margin: 0;
            background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .warning-text { color: #ff4d4d; font-weight: bold; font-size: 14px; margin-top: 8px; display: block; }
        .intro-text { font-size: 13px; color: #94a3b8; line-height: 1.6; margin-top: 10px; }
        
        .copy-box { 
            background: rgba(191, 149, 63, 0.08); padding: 15px; border-radius: 15px; 
            border: 1px dashed #bf953f; margin-top: 15px; font-size: 14px; cursor: pointer;
            transition: 0.3s;
        }
        .copy-box:hover { background: rgba(191, 149, 63, 0.15); }
        .copy-box b { color: var(--text-gold); font-size: 20px; letter-spacing: 1px; }

        .input-group { margin-bottom: 18px; text-align: right; }
        label { display: block; margin-bottom: 6px; font-size: 13px; color: var(--text-gold); font-weight: bold; }
        .hint-text { color: #ff4d4d; font-size: 11px; margin-top: 5px; display: block; font-weight: bold; }

        input, select {
            width: 100%; background: #151515; border: 1px solid rgba(191, 149, 63, 0.2);
            border-radius: 12px; padding: 12px; color: white; font-size: 15px; box-sizing: border-box; outline: none;
            transition: 0.3s; font-family: 'Tajawal', sans-serif;
        }
        input:focus { border-color: #fcf6ba; box-shadow: 0 0 10px rgba(191, 149, 63, 0.2); }
        
        .file-label {
            display: block; background: #1a1a1a; border: 2px dashed rgba(191, 149, 63, 0.5);
            border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; transition: 0.3s; color: #fcf6ba; font-weight: bold;
        }
        .file-label:hover { border-color: #fcf6ba; background: rgba(191, 149, 63, 0.1); }

        .calc-box { 
            background: rgba(191, 149, 63, 0.05); padding: 15px; border-radius: 15px; 
            text-align: center; margin: 15px 0; border: 1px solid rgba(191, 149, 63, 0.1); 
        }
        .calc-value { font-size: 22px; font-weight: 700; color: #fff; }

        button#submitBtn {
            width: 100%; padding: 16px; background: var(--gold);
            border: none; border-radius: 12px; color: #000; font-size: 18px; font-weight: 700; cursor: pointer; transition: 0.3s;
        }
        button#submitBtn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        button:disabled { filter: grayscale(1); cursor: not-allowed; }

        #invoiceOverlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000; align-items: center; justify-content: center; padding: 20px;
        }
        .invoice-box { 
            background: #0d0d0d; color: #fff; width: 100%; max-width: 400px; padding: 30px; 
            border-radius: 25px; text-align: center; border: 2px solid #bf953f; 
            box-shadow: 0 0 30px rgba(191, 149, 63, 0.3);
        }
        .inv-header { font-size: 24px; font-weight: 900; background: var(--gold); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 20px; }
        .inv-item { display: flex; justify-content: space-between; border-bottom: 1px solid rgba(191, 149, 63, 0.1); padding: 12px 0; font-size: 14px; }
        .inv-label { color: #94a3b8; }
        .inv-value { color: #fcf6ba; font-weight: bold; }
        .thanks-note { margin-top: 25px; font-size: 13px; color: #fcf6ba; line-height: 1.6; font-style: italic; }

        #copyToast {
            visibility: hidden; min-width: 100px; background-color: #bf953f; color: #000; text-align: center;
            border-radius: 50px; padding: 8px; position: fixed; z-index: 1001; bottom: 30px; left: 50%;
            transform: translateX(-50%); font-size: 12px; font-weight: bold;
        }
        #copyToast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 1.5s; }
    </style>
</head>
<body>

<div class="form-card">
    <div class="header">
        <h1>Helmy Card ğŸ”—</h1>
        <span class="warning-text">ÙŠØ³ØªØºØ±Ù‚ ØªØ£ÙƒÙŠØ¯ Ø§Ù„ØªØ§Ø±Ø¬Øª ÙˆØ¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø£Ù…ÙˆØ§Ù„ 24 Ø³Ø§Ø¹Ø©</span>
        <div class="intro-text">
            Ø¨Ø¹Ø¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø³Ø­Ø¨ Ø£Ù†Øª ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø´Ø±ÙˆØ· Ø§Ù„Ø®Ø¯Ù…Ø© Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒÙ… _ Helmy Card ğŸ”—
        </div>
        <div class="copy-box" onclick="copyId()">
            ID Ø³Ø­Ø¨ Karak chat: <b id="adminId">800050</b><br>
            Ø§Ù„Ø§Ø³Ù…: <b>Helmy fire</b><br>
            <small>Ø§Ø¶ØºØ· Ù‡Ù†Ø§ Ù„Ù†Ø³Ø® Ø§Ù„Ø§ÙŠØ¯ÙŠ ÙˆØ§Ø±Ø³Ù„ Ø§Ù„Ø±Ø§ØªØ¨ ğŸ‘†</small>
        </div>
    </div>

    <div class="input-group">
        <label>ğŸ†” Ø§Ù„ÙŠ Ø³Ø­Ø¨Øª Ù…Ù†Ùˆ id</label>
        <input type="text" id="user_id" placeholder="Ø£Ø¯Ø®Ù„ ID Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ" required>
    </div>

    <div class="input-group">
        <label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
        <input type="text" id="agent_name" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ Ø¥Ù† ÙˆØ¬Ø¯">
    </div>

    <div class="input-group">
        <label>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>
        <select id="method" onchange="calculate()">
            <option value="ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´">ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´</option>
            <option value="Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´">Ø§ØªØµØ§Ù„Ø§Øª ÙƒØ§Ø´</option>
            <option value="Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´">Ø£ÙˆØ±Ù†Ø¬ ÙƒØ§Ø´</option>
            <option value="ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©">ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ© (Ø³Ø¹Ø± Ø®Ø§Øµ)</option>
        </select>
    </div>

    <div class="input-group">
        <label>Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±</label>
        <input type="number" id="dollars" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±Ø§Øª" oninput="calculate()" required>
    </div>

    <div class="calc-box">
        <div class="calc-value" id="res-egp">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0.00 Ø¬.Ù…</div>
    </div>

    <div class="input-group">
        <label>Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</label>
        <input type="text" id="wallet" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø°ÙŠ Ø³ÙŠØµÙ„Ùƒ Ø¹Ù„ÙŠÙ‡ Ø§Ù„Ù…Ø¨Ù„Øº" required>
        <span class="hint-text">Ø§Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± 010 ÙŠØªÙ… Ø®ØµÙ… Ø¹Ù…ÙˆÙ„Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.</span>
    </div>

    <div class="input-group">
        <label>Ø¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„ (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)</label>
        <label for="screenshot" class="file-label" id="fileLabel">
            <span id="labelText">ğŸ“¸ Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„</span>
            <input type="file" id="screenshot" accept="image/*" style="display:none" onchange="updateLabel()" required>
        </label>
    </div>

    <button onclick="submitForm()" id="submitBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€</button>
</div>

<div id="copyToast">ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø£ÙŠØ¯ÙŠ Ø¨Ù†Ø¬Ø§Ø­ âœ…</div>

<div id="invoiceOverlay">
    <div class="invoice-box">
        <div class="inv-header">ÙØ§ØªÙˆØ±Ø© Ø³Ø­Ø¨ Ø±Ø§ØªØ¨ âœ…</div>
        <div class="inv-item"><span class="inv-label">ID Ø§Ù„Ø­Ø³Ø§Ø¨:</span> <span class="inv-value" id="inv-uid"></span></div>
        <div class="inv-item"><span class="inv-label">Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„:</span> <span class="inv-value" id="inv-agent"></span></div>
        <div class="inv-item"><span class="inv-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±:</span> <span class="inv-value" id="inv-usd"></span></div>
        <div class="inv-item"><span class="inv-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø¨Ø§Ù„Ù…ØµØ±ÙŠ:</span> <span class="inv-value" id="inv-egp"></span></div>
        <div class="inv-item"><span class="inv-label">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:</span> <span class="inv-value" id="inv-method"></span></div>
        <div class="inv-item"><span class="inv-label">Ø§Ù„ÙŠÙˆÙ…:</span> <span class="inv-value" id="inv-day"></span></div>
        <div class="inv-item"><span class="inv-label">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span> <span class="inv-value" id="inv-time" style="font-size: 11px;"></span></div>
        
        <div class="thanks-note">
            Ø´ÙƒØ±Ù‹Ø§ Ù„Ø«Ù‚ØªÙƒ Ø¨Ù†Ø§ ÙˆØ¨Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Helmy Card ğŸ”—<br>
            Ù†ØªÙ…Ù†Ù‰ Ù„Ùƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹ ØªØ¬Ø±Ø¨Ø© Ù…Ù…ÙŠØ²Ø© ÙˆÙ…ÙˆÙÙ‚Ø©. â˜•
        </div>

        <button onclick="location.reload()" style="background:var(--gold); color:#000; border:none; width:100%; padding:15px; border-radius:12px; cursor:pointer; font-weight: bold; margin-top: 20px;">Ø¥ØºÙ„Ø§Ù‚ ÙˆØ­ÙØ¸</button>
    </div>
</div>

<script>
    const SHEET_URL = 'https://sheetdb.io/api/v1/5t77aw7docius?sheet=Karak chat';

    function updateLabel() {
        const file = document.getElementById('screenshot').files[0];
        if(file) document.getElementById('labelText').innerText = "âœ… ØªÙ… Ø§Ø®ØªÙŠØ§Ø±: " + file.name;
    }

    function copyId() {
        const idText = document.getElementById('adminId').innerText;
        navigator.clipboard.writeText(idText).then(() => {
            const toast = document.getElementById("copyToast");
            toast.className = "show";
            setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 2000);
        });
    }

    function calculate() {
        const usd = document.getElementById('dollars').value;
        const method = document.getElementById('method').value;
        const rate = (method === "ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©") ? 46.50 : 45;
        const egp = (usd * rate).toFixed(2);
        document.getElementById('res-egp').innerText = usd > 0 ? "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: " + egp + " Ø¬.Ù…" : "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: 0.00 Ø¬.Ù…";
    }

    async function submitForm() {
        const btn = document.getElementById('submitBtn');
        const userId = document.getElementById('user_id').value;
        const agentName = document.getElementById('agent_name').value || "Ù„Ø§ ÙŠÙˆØ¬Ø¯";
        const usdValue = document.getElementById('dollars').value;
        const method = document.getElementById('method').value;
        const wallet = document.getElementById('wallet').value;
        const photoFile = document.getElementById('screenshot').files[0];

        if(!userId || !usdValue || !wallet || !photoFile) { 
            alert("ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø±ÙØ§Ù‚ ØµÙˆØ±Ø© Ø§Ù„ØªØ­ÙˆÙŠÙ„!"); 
            return; 
        }

        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ...";

        try {
            const response = await fetch(SHEET_URL);
            const dataSheet = await response.json();
            
            const fiveDaysAgo = new Date();
            fiveDaysAgo.setDate(fiveDaysAgo.getDate() - 5);

            const isDuplicate = dataSheet.some(row => {
                if(!row["Ø§Ù„ØªØ§Ø±ÙŠØ®"]) return false;
                const parts = row["Ø§Ù„ØªØ§Ø±ÙŠØ®"].split(',')[0].split('/');
                const rowDate = new Date(parts[2], parts[1]-1, parts[0]); 
                return row["Ø§Ù„Ø£ÙŠØ¯ÙŠ"] === userId && rowDate >= fiveDaysAgo;
            });

            if (isDuplicate) {
                alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù‡Ø°Ø§ Ø§Ù„Ø£ÙŠØ¯ÙŠ Ù‚Ø§Ù… Ø¨Ø¹Ù…Ù„ÙŠØ© Ø³Ø­Ø¨ Ø®Ù„Ø§Ù„ Ø§Ù„Ù€ 5 Ø£ÙŠØ§Ù… Ø§Ù„Ù…Ø§Ø¶ÙŠØ©.");
                btn.disabled = false; btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€";
                return;
            }

            const now = new Date();
            const days = ["Ø§Ù„Ø£Ø­Ø¯", "Ø§Ù„Ø§Ø«Ù†ÙŠÙ†", "Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡", "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡", "Ø§Ù„Ø®Ù…ÙŠØ³", "Ø§Ù„Ø¬Ù…Ø¹Ø©", "Ø§Ù„Ø³Ø¨Øª"];
            const currentDay = days[now.getDay()];
            const dateStr = now.toLocaleDateString('en-GB') + ", " + now.toLocaleTimeString('ar-EG');
            
            const finalRate = (method === "ÙƒÙˆØ¯ Ø§Ù„ÙˆÙƒÙŠÙ„ ÙÙŠ Ø§Ù„Ù…Ù†ØµØ©") ? 46.50 : 45;
            const egpVal = (usdValue * finalRate).toFixed(2);

            const token = "8493256102:AAFuFPixyivycVPImhz7dMAtpcP0-NsZMpk";
            const chat_id = "7054064246";
            const msg = `ğŸ§¾ *Ø·Ù„Ø¨ Ø³Ø­Ø¨ Ø¬Ø¯ÙŠØ¯ Karak chat*\n\nğŸ†” *ID:* ${userId}\nğŸ‘¤ *Ø§Ù„ÙˆÙƒÙŠÙ„:* ${agentName}\nğŸ’µ *Ø§Ù„Ù…Ø¨Ù„Øº:* ${usdValue} $\nğŸ‡ªğŸ‡¬ *Ø§Ù„Ù…ØµØ±ÙŠ:* ${egpVal} Ø¬.Ù…\nğŸ’³ *Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©:* ${method}\nğŸ¦ *Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…:* ${wallet}\nğŸ“… *Ø§Ù„ÙŠÙˆÙ…:* ${currentDay}\nâ° *Ø§Ù„ØªØ§Ø±ÙŠØ®:* ${dateStr}`;

            const formData = new FormData();
            formData.append('chat_id', chat_id);
            formData.append('photo', photoFile);
            formData.append('caption', msg);
            formData.append('parse_mode', 'Markdown');
            await fetch(`https://api.telegram.org/bot${token}/sendPhoto`, { method: 'POST', body: formData });

            await fetch(SHEET_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ data: [{
                    "Ø§Ù„Ø£ÙŠØ¯ÙŠ": userId,
                    "Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„": agentName,
                    "Ø§Ù„Ø¯ÙˆÙ„Ø§Ø±": usdValue + " $",
                    "Ø§Ù„Ù…ØµØ±ÙŠ": egpVal + " Ø¬.Ù…",
                    "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø³Ø­Ø¨": method,
                    "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙØ¸Ø©": "'" + wallet,
                    "Ø§Ù„ØªØ§Ø±ÙŠØ®": dateStr,
                    "Ø§Ù„ÙŠÙˆÙ…": currentDay
                }]})
            });

            document.getElementById('inv-uid').innerText = userId;
            document.getElementById('inv-agent').innerText = agentName;
            document.getElementById('inv-usd').innerText = usdValue + " $";
            document.getElementById('inv-egp').innerText = egpVal + " Ø¬.Ù…";
            document.getElementById('inv-method').innerText = method;
            document.getElementById('inv-day').innerText = currentDay;
            document.getElementById('inv-time').innerText = dateStr;
            document.getElementById('invoiceOverlay').style.display = 'flex';

        } catch (e) { 
            alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ØªÙ‚Ù†ÙŠ!"); 
            btn.disabled = false; btn.innerText = "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù† ğŸš€";
        }
    }
</script>
</body>
</html>
